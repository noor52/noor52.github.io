---
layout: post
title: log view
subtitle: Log view Form Implementation with Angular and Spring Boot
gh-repo: daattali/beautiful-jekyll
gh-badge: [star, fork, follow]
tags: [REST, Angular, Pagination, Java, Spring Boot]
comments: true
mathjax: false
author: Noor
---

#  Form Implementation Guide

## 1. Frontend Components

### HTML Template
```html
<div class="container-fluid">
  <nz-card>
    <div class="ng-Header col-xs-12">
      <i nz-icon nzType="search" nzTheme="outline"></i> Search
    </div>
    <form
      nz-form
      [formGroup]="searchForm"
      class="ant-advanced-search-form"
      (ngSubmit)="submitSearchForm()"
      style="
        padding: 24px;
        background: #fbfbfb;
        border: 1px solid #d9d9d9;
        border-radius: 6px;
      "
    >
      <div class="row">
        <div class="col-md-4">
          <nz-form-label style="margin-left: 15px"
            >Research Start Date</nz-form-label
          >
          <div class="col-md-12">
            <nz-form-item>
              <nz-form-control
                [nzSpan]="null"
                nzHasFeedback
                nz-col
                nzErrorTip="Please insert valid Date"
              >
                <nz-date-picker
                  formControlName="researchFromDate"
                  placeholder="From Date"
                  style="width: 100%"
                >
                </nz-date-picker>
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
        <div class="col-md-4">
          <nz-form-label style="margin-left: 15px"
            >Research End Date</nz-form-label
          >
          <div class="col-md-12">
            <nz-form-item>
              <nz-form-control
                [nzSpan]="null"
                nzHasFeedback
                nz-col
                nzErrorTip="Please insert valid Date"
              >
                <nz-date-picker
                  formControlName="researchToDate"
                  placeholder="to Date"
                  style="width: 100%"
                >
                </nz-date-picker>
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
        <div class="col-md-4">
          <div class="col-md-12">
            <nz-form-label>Document ID</nz-form-label>
            <nz-form-item>
              <nz-form-control nzErrorTip="Please insert valid document id">
                <input
                  nz-input
                  type="text"
                  placeholder="Document ID"
                  formControlName="documentId"
                />
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
        <div class="col-md-4">
          <div class="col-md-12">
            <nz-form-label>Research Title</nz-form-label>
            <nz-form-item>
              <nz-form-control nzErrorTip="Please insert valid title">
                <input
                  nz-input
                  type="text"
                  placeholder="Title"
                  formControlName="title"
                />
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
        <div class="form-group col-md-4">
          <div class="col-md-12">
            <div class="row">
              <div style="margin-left: 15px">
                <nz-form-label>Research Type</nz-form-label>
              </div>
            </div>
            <nz-form-item>
              <nz-form-control nzHasFeedback [nzErrorTip]="rtNameErrorTpl">
                <nz-select
                  nzShowSearch
                  nzAllowClear
                  formControlName="researchTypeId"
                  nzPlaceHolder="Select type"
                >
                  <nz-option
                    *ngFor="let rt of researchTypeList"
                    [nzValue]="rt.id"
                    [nzLabel]="rt.name"
                  >
                  </nz-option>
                </nz-select>
                <ng-template #rtNameErrorTpl let-control>
                  <ng-container *ngIf="control.hasError('required')">
                    Please select type !
                  </ng-container>
                </ng-template>
              </nz-form-control>
              <ng-template #rtNameErrorTpl let-control>
                <ng-container *ngIf="control.hasError('required')">
                  Insert title please!
                </ng-container>
                <ng-container *ngIf="control.hasError('whitespace')"
                  >Insert valid title please!</ng-container
                >
              </ng-template>
            </nz-form-item>
          </div>
        </div>
        <div class="form-group col-md-4">
          <div class="col-md-12">
            <div>
              <nz-form-label>Access Type</nz-form-label>
            </div>
            <nz-form-item>
              <nz-form-control nzHasFeedback>
                <nz-select
                  nzShowSearch
                  nzAllowClear
                  formControlName="accessTypeId"
                  nzPlaceHolder="Select type"
                >
                  <nz-option
                    *ngFor="let at of accessTypeList"
                    [nzValue]="at.id"
                    [nzLabel]="at.name"
                  >
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <div class="col-md-12">
            <nz-form-label>Filter</nz-form-label>
            <nz-form-item>
              <nz-form-control>
                <input
                  nz-input
                  type="text"
                  placeholder="Enter Text"
                  formControlName="globalText"
                />
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
      </div>

      <div nz-row>
        <div nz-col [nzSpan]="24" class="search-area text-right">
          <button nz-button [nzType]="'primary'">Search</button>
          <button class="btn-success ml-3" nz-button (click)="onRefresh()">
            Refresh Data
          </button>
          <button
            type="button"
            class="btn-info ml-3"
            (click)="onDownloadReport()"
            nz-button
          >
            Download Report
          </button>
        </div>
      </div>
    </form>
  </nz-card>

  <nz-card>
    <div class="ng-Header col-xs-12">
      <i nz-icon nzType="unordered-list" nzTheme="outline"></i>
      {{
        "List of Research
      & Studies" | translate
      }}
    </div>
    <div nz-col [nzSpan]="24">
      <nz-table
        #basicTableForAdminListInfo
        [nzData]="adminListInfo"
        nzTableLayout="fixed"
        nzShowSizeChanger
        nzBordered
        nzSize="middle"
        nzAlign="middle"
        [nzFrontPagination]="false"
        [nzTotal]="total"
        [(nzPageSize)]="size"
        [nzShowTotal]="totalRowRangeTemplate"
        [(nzPageIndex)]="page"
        (nzQueryParams)="onQueryParamsChange($event)"
        [nzPaginationPosition]="'both'"
        [nzScroll]="{ x: '1100px' }"
      >
        <ng-template
          #totalRowRangeTemplate
          let-range="range"
          let-total
          style="text-align: left"
        >
          <div style="text-align: left">
            Showing {{ range[0] }}-{{ range[1] }} of {{ total }} items
          </div>
        </ng-template>
        <thead>
          <tr>
            <th style="width: 50px; text-align: center" rowspan="1">SI.</th>
            <th
              style="text-align: center"
              rowspan="1"
              nzColumnKey="document_id"
              [nzSortFn]="true"
            >
              Document ID
            </th>
            <th
              style="text-align: center"
              rowspan="1"
              nzColumnKey="title"
              [nzSortFn]="true"
            >
              Title
            </th>
            <th
              style="text-align: center"
              rowspan="1"
              nzColumnKey="research_type_id"
              [nzSortFn]="true"
            >
              Research Type
            </th>
            <th
              style="text-align: center"
              rowspan="1"
              nzColumnKey="research_from_date"
              [nzSortFn]="true"
            >
              Research Start Date
            </th>
            <th
              style="text-align: center"
              rowspan="1"
              nzColumnKey="research_to_date"
              [nzSortFn]="true"
            >
              Research End Date
            </th>
            <th style="text-align: center">Application Status</th>
            <th style="width: 15%; text-align: center">User Type</th>
            <th style="width: 15%; text-align: center">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let data of basicTableForAdminListInfo.data; let i = index"
          >
            <td style="text-align: center">
              {{ (page - 1) * size + 1 + i }}
            </td>
            <td style="text-align: center; vertical-align: middle">
              <a
                [routerLink]="['../document-view']"
                [queryParams]="{ researchStudiesMainId: data.id }"
                target="_blank"
                routerLinkActive="router-link-active"
                >{{ data.documentId }}</a
              >
            </td>
            <td style="text-align: center; vertical-align: middle">
              {{ data.title }}
            </td>
            <td style="text-align: center; vertical-align: middle">
              {{ data.researchType.name }}
            </td>
            <td style="text-align: center; vertical-align: middle">
              {{ data.researchFromDate | date : "dd-MM-yyyy" }}
            </td>
            <td style="text-align: center; vertical-align: middle">
              {{ data.researchToDate | date : "dd-MM-yyyy" }}
            </td>
            <td style="text-align: center; vertical-align: middle">
              <span
                *ngIf="data.statusType?.id == 1"
                class="badge badge-primary"
                style="font-size: 10px"
              >
                {{ data.statusType?.name }}
              </span>
              <span
                *ngIf="data.statusType?.id == 2"
                class="badge badge-primary"
                style="font-size: 10px"
              >
                {{ data.statusType?.name }}
              </span>
              <span
                *ngIf="data.statusType?.id == 3"
                class="badge badge-success"
                style="font-size: 10px"
              >
                {{ data.statusType?.name }}
              </span>
              <span
                *ngIf="data.statusType?.id == 4"
                class="badge badge-danger"
                style="font-size: 10px"
              >
                {{ data.statusType?.name }}
              </span>
              <span
                *ngIf="data.statusType?.id == 5"
                class="badge badge-success"
                style="font-size: 10px"
              >
                {{ data.statusType?.name }}
              </span>
              <span
                *ngIf="data.statusType?.id == 6"
                class="badge badge-danger"
                style="font-size: 10px"
              >
                {{ data.statusType?.name }}
              </span>
              <span
                *ngIf="data.statusType?.id == 7"
                class="badge badge-success"
                style="font-size: 10px"
              >
                {{ data.statusType?.name }}
              </span>
              <span
                *ngIf="data.statusType?.id == 8"
                class="badge badge-success"
                style="font-size: 10px"
              >
                {{ data.statusType?.name }}
              </span>
              <span
                *ngIf="data.statusType?.id == 9"
                class="badge badge-warning"
                style="font-size: 10px"
              >
                {{ data.statusType?.name }}
              </span>
              <span
                *ngIf="data.statusType?.id == 10"
                class="badge badge-success"
                style="font-size: 10px"
              >
                {{ data.statusType?.name }}
              </span>
              <span
                *ngIf="data.statusType?.id == 11"
                class="badge badge-success"
                style="font-size: 10px"
              >
                {{ data.statusType?.name }}
              </span>
              <span
                *ngIf="data.statusType?.id == 12"
                class="badge badge-danger"
                style="font-size: 10px"
              >
                {{ data.statusType?.name }}
              </span>
              <span
                *ngIf="data.statusType?.id == 13"
                class="badge badge-success"
                style="font-size: 10px"
              >
                {{ data.statusType?.name }}
              </span>
              <span
                *ngIf="data.statusType?.id == 14"
                class="badge badge-success"
                style="font-size: 10px"
              >
                {{ data.statusType?.name }}
              </span>
            </td>
            <td style="text-align: center; vertical-align: middle">
              {{ data.researchStudiesUserType?.name }}
            </td>
            <td style="text-align: center; vertical-align: middle">
              <a
                class="ml-2 mt-2"
                nz-tooltip
                nzTooltipTitle="View in Details"
                nzTooltipPlacement="bottomLeft"
                nz-button
                nzType="primary"
                nzSize="small"
                [routerLink]="['../document-view']"
                [queryParams]="{ researchStudiesMainId: data.id }"
                target="_blank"
                routerLinkActive="router-link-active"
                style="margin: 1%; display: inline-block;"
                [appRequiredPermission]="
                  applicationPermissions.researchAndStudies
                    .adminListViewButtonPermission
                "
              >
                <i nz-icon nzType="eye" nzTheme="outline"></i>
              </a>

              <a
                nz-button
                nzType="primary"
                nzSize="small"
                [routerLink]="['/home/research-and-studies/add']"
                [queryParams]="{ researchStudiesMainId: data.id }"
                target="_blank"
                routerLinkActive="router-link-active"
                style="margin: 1%; display: inline-block;"
                nz-tooltip
                [nzTooltipTitle]="'Edit Document'"
                nzTooltipPlacement="bottomLeft"
              >
                <i nz-icon nzType="edit" nzTheme="outline"></i>
              </a>

              <a
                nz-button
                type="button"
                nzType="primary"
                nzSize="small"
                (click)="onDownloadFile(data.id)"
                nz-tooltip
                [nzTooltipTitle]="'Download Document'"
                nzTooltipPlacement="bottomLeft"
                style="margin: 1%; display: inline-block;"
              >
                <i nz-icon nzType="download" nzTheme="outline"></i>
              </a>

              <a
                nz-button
                type="button"
                nzType="danger"
                nzSize="small"
                nz-popconfirm
                [nzPopconfirmTitle]="
                  'Are you sure to delete this document id: ' +
                  data.documentId +
                  '?'
                "
                (nzOnConfirm)="deleteDocument(data.id, i)"
                nz-tooltip
                [nzTooltipTitle]="'Delete Document'"
                nzTooltipPlacement="bottomLeft"
                [disabled]="data.statusType?.id != 1"
                style="margin: 1%; display: inline-block;"
              >
                <i nz-icon nzType="delete" nzTheme="outline"></i>
              </a>

              <a
                *ngIf="data.statusType?.id == 2"
                nz-button
                type="button"
                nzType="primary"
                nzSize="small"
                [routerLink]="['/home/research-and-studies/approval-details']"
                [queryParams]="{ researchStudiesMainId: data.id }"
                nz-popconfirm
                nz-tooltip
                [nzTooltipTitle]="'Level -1 Recommendation'"
                nzTooltipPlacement="bottomLeft"
                style="margin: 1%; display: inline-block;"
                style="margin: 1%"
                [appRequiredPermission]="
                  applicationPermissions.researchAndStudies
                    .levelOneRecommendationButtonPermission
                "
              >
                <i nz-icon nzType="check" nzTheme="outline"></i>
              </a>

              <a
                *ngIf="data.statusType?.id == 3 || data.statusType?.id == 4"
                nz-button
                type="button"
                nzType="primary"
                nzSize="small"
                [routerLink]="['/home/research-and-studies/approval-details']"
                [queryParams]="{ researchStudiesMainId: data.id }"
                nz-popconfirm
                nz-tooltip
                [nzTooltipTitle]="'Level -2 Recommendation'"
                nzTooltipPlacement="bottomLeft"
                style="margin: 1%; display: inline-block;"
                style="margin: 1%"[appRequiredPermission]="
                applicationPermissions.researchAndStudies
                  .levelTwoRecommendationButtonPermission
              "
              >
                <i nz-icon nzType="check" nzTheme="outline"></i>
              </a>

              <a
                *ngIf="data.statusType?.id == 5 || data.statusType?.id == 6"
                nz-button
                type="button"
                nzType="primary"
                nzSize="small"
                [routerLink]="['/home/research-and-studies/approval-details']"
                [queryParams]="{ researchStudiesMainId: data.id }"
                nz-popconfirm
                nz-tooltip
                [nzTooltipTitle]="'Level -3 Recommendation'"
                nzTooltipPlacement="bottomLeft"
                style="margin: 1%"[appRequiredPermission]="
                applicationPermissions.researchAndStudies
                  .levelThreeRecommendationButtonPermission
              "
              >
                <i nz-icon nzType="check" nzTheme="outline"></i>
              </a>
              <a
                *ngIf="
                  data.isOpinionOpenToCollect == true &&
                  (data.statusType?.id == 7 ||
                    data.statusType?.id == 8 ||
                    data.statusType?.id == 10 ||
                    data.statusType?.id == 11 ||
                    data.statusType?.id == 13)
                "
                nz-button
                type="button"
                nzType="primary"
                nzSize="small"
                (click)="showModalForOpinion(data.id)"
                nz-popconfirm
                nz-tooltip
                [nzTooltipTitle]="'View Opinion'"
                nzTooltipPlacement="bottomLeft"
                style="margin: 1%; display: inline-block;"
              >
                <i nz-icon nzType="folder-view" nzTheme="outline"></i>
              </a>
              <a
              class="ml-2 mt-2"
              nz-tooltip
              nzTooltipTitle="View local_gas_station History"
              nzTooltipPlacement="bottomLeft"
              nz-button
              nzType="primary"
              nzSize="small"
              [routerLink]="['/home/research-and-studies/history-log']"
              [queryParams]="{ researchStudiesMainId: data.id }"
              target="_blank"
              routerLinkActive="router-link-active"
              style="margin: 1%; display: inline-block;"
              [appRequiredPermission]="
                applicationPermissions.researchAndStudies
                  .historyLogViewButtonPermission
              "
            >
                <i nz-icon nzType="arrow-right" nzTheme="outline"></i>
              </a>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </nz-card>
</div>
<!-- <nz-modal
  [nzTitle]="'Research & Studies Details Information'"
  [(nzVisible)]="isVisibleDetails"
  (nzOnCancel)="handleCancelDetailsModal()"
  [nzWidth]="1100"
>
  <nz-card>
    <div class="ng-Header col-xs-12">
      <i nz-icon nzType="unordered-list" nzTheme="outline"></i> Research & Studies Details
    </div>
    <div class="container-fluid">
      <nz-table
        #basicTable
        [nzData]="['']"
        nzBordered
        [nzShowPagination]="false"
        nzAlign="middle"
      >
        <tbody *ngIf="researchAndStudiesMainInfoDetails">
          <tr>
            <td style="text-align: left; font-weight: bold">Research Type</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.researchType?.name }}
            </td>
            <td style="text-align: left; font-weight: bold">Title</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.title }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">Research Type</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.researchType?.name }}
            </td>
            <td style="text-align: left; font-weight: bold">Title</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.title }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">Abstract</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.abstracts }}
            </td>
            <td style="text-align: left; font-weight: bold">Area of Focus</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.areaOfFocus }}
            </td>
          </tr>

          <tr>
            <td style="text-align: left; font-weight: bold">Document ID</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.documentId }}
            </td>
            <td style="text-align: left; font-weight: bold">Outcome</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.outcome }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">Future Scope</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.futureScope }}
            </td>
            <td style="text-align: left; font-weight: bold">Conduct Type</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.conductType?.name }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">Conducted By</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.conductedByName }}
            </td>
            <td style="text-align: left; font-weight: bold">Other Conductor</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.otherConductor }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">
              Researcher Organization
            </td>
            <td style="text-align: left">
              {{
                researchAndStudiesMainInfoDetails?.researcherOrganizationName
              }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">
              Other Researcher Organization
            </td>
            <td style="text-align: left">
              {{
                researchAndStudiesMainInfoDetails?.otherOtherResearcherOrganization
              }}
            </td>
            <td style="text-align: left; font-weight: bold">Supported By</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.supportedBy }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">Fund</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.fund?.name }}
            </td>
            <td style="text-align: left; font-weight: bold">Other Fund</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.otherFund }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">
              Research From Date
            </td>
            <td style="text-align: left">
              {{
                researchAndStudiesMainInfoDetails?.researchFromDate
                  | date : "dd-MM-YYYY"
              }}
            </td>
            <td style="text-align: left; font-weight: bold">
              Research To Date
            </td>
            <td style="text-align: left">
              {{
                researchAndStudiesMainInfoDetails?.researchToDate
                  | date : "dd-MM-YYYY"
              }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">
              Validation Conducted?
            </td>
            <td style="text-align: left">
              {{
                researchAndStudiesMainInfoDetails?.isValidationConducted == true
                  ? "Yes"
                  : "No"
              }}
            </td>
            <td style="text-align: left; font-weight: bold">
              Date of Validation
            </td>
            <td style="text-align: left">
              {{
                researchAndStudiesMainInfoDetails?.dateOfValidation
                  | date : "dd-MM-yyyy"
              }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">
              Date of Publication
            </td>
            <td style="text-align: left">
              {{
                researchAndStudiesMainInfoDetails?.dateOfPublication
                  | date : "dd-MM-yyyy"
              }}
            </td>
            <td style="text-align: left; font-weight: bold">Sector Specify?</td>
            <td style="text-align: left">
              {{
                researchAndStudiesMainInfoDetails?.isSectorSpecify == true
                  ? "Yes"
                  : "No"
              }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">Name of Sector</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.nameOfSector }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">Language</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.language?.name }}
            </td>
            <td style="text-align: left; font-weight: bold">Access Type</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.accessType?.name }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">Remarks</td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.remarks }}
            </td>
            <td style="text-align: left; font-weight: bold">
              Opinion Open to Collect?
            </td>
            <td style="text-align: left">
              {{
                researchAndStudiesMainInfoDetails?.isOpinionOpenToCollect ==
                true
                  ? "Yes"
                  : "No"
              }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">
              Opinion Start Date
            </td>
            <td style="text-align: left">
              {{
                researchAndStudiesMainInfoDetails?.opinionStartDate
                  | date : "dd-MM-yyyy"
              }}
            </td>
            <td style="text-align: left; font-weight: bold">
              Opinion End Date
            </td>
            <td style="text-align: left">
              {{
                researchAndStudiesMainInfoDetails?.opinionEndDate
                  | date : "dd-MM-yyyy"
              }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">
              Opinion Giver Name
            </td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.opinionGiverName }}
            </td>
            <td style="text-align: left; font-weight: bold">
              Opinion Giver Occupation
            </td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.opinionGiverOccupation }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">
              Opinion Giver Designation
            </td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.opinionGiverDesignation }}
            </td>
            <td style="text-align: left; font-weight: bold">
              Opinion Giver Company
            </td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.opinionGiverCompany }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">
              Opinion Giver Email
            </td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.opinionGiverEmail }}
            </td>
            <td style="text-align: left; font-weight: bold">
              Opinion Giver Mobile
            </td>
            <td style="text-align: left">
              {{ researchAndStudiesMainInfoDetails?.opinionGiverMobile }}
            </td>
          </tr>
          <tr>
            <td style="text-align: left; font-weight: bold">Objective</td>
            <td style="text-align: left; width: 30%">
              {{ researchAndStudiesMainInfoDetails?.objectives }}
            </td>
            <td style="text-align: left; font-weight: bold">Other Research</td>
            <td style="text-align: left; width: 30%">
              {{ researchAndStudiesMainInfoDetails?.otherResearch }}
            </td>
          </tr>
        </tbody>
      </nz-table>
      <div *nzModalFooter>
        <button nz-button nzType="primary" (click)="handleCancelDetailsModal()">
          Close
        </button>
      </div>
    </div>
  </nz-card>
  <nz-card>
    <div class="ng-Header col-xs-12">
      <i nz-icon nzType="unordered-list" nzTheme="outline"></i> Author Info
    </div>
    <div nz-col [nzSpan]="24">
      <nz-table
        #basicTables
        [nzData]="authorList"
        nzTableLayout="fixed"
        nzShowSizeChanger
        nzBordered
        nzSize="middle"
        nzAlign="middle"
      >
        <thead>
          <tr>
            <th style="width: 50px; text-align: center" rowspan="1">SI.</th>
            <th style="text-align: center" rowspan="1">Name</th>
            <th style="text-align: center" rowspan="1">Designation</th>
            <th style="text-align: center" rowspan="1">Organization</th>
            <th style="text-align: center" rowspan="1">Email</th>
            <th style="text-align: center" rowspan="1">Contact No</th>
            <th style="text-align: center" rowspan="1">Gender</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of basicTables.data; let i = index">
            <td style="text-align: center">
              {{ 1 + i }}
            </td>
            <td style="text-align: center; vertical-align: middle">
              {{ data.name }}
            </td>

            <td style="text-align: center; vertical-align: middle">
              {{ data.designation }}
            </td>
            <td style="text-align: center; vertical-align: middle">
              {{ data.organization }}
            </td>
            <td style="text-align: center; vertical-align: middle">
              {{ data.email }}
            </td>
            <td style="text-align: center; vertical-align: middle">
              {{ data.contactNo }}
            </td>
            <td style="text-align: center; vertical-align: middle">
              {{ data?.gender == "male" ? "Male" : "Female" }}
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </nz-card>
  <nz-card>
    <div class="ng-Header col-xs-12">
      <i nz-icon nzType="unordered-list" nzTheme="outline"></i> Related Research
      Info
    </div>
    <div nz-col [nzSpan]="24">
      <nz-table
        #basicTableOfrelatedResearch
        [nzData]="relatedResearchList"
        nzTableLayout="fixed"
        nzShowSizeChanger
        nzBordered
        nzSize="middle"
        nzAlign="middle"
      >
        <thead>
          <tr>
            <th style="width: 50px; text-align: center" rowspan="1">SI.</th>
            <th style="text-align: center" rowspan="1">Document ID</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let data of basicTableOfrelatedResearch.data; let i = index"
          >
            <td style="text-align: center">
              {{ 1 + i }}
            </td>
            <td style="text-align: center; vertical-align: middle">
              {{ data.documentId }}
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </nz-card>
  <nz-card>
    <div class="ng-Header col-xs-12">
      <i nz-icon nzType="unordered-list" nzTheme="outline"></i> Attachment Info
    </div>
    <div nz-col [nzSpan]="24">
      <nz-table
        #basicTableOfAttachment
        [nzData]="attachmentList"
        nzTableLayout="fixed"
        nzShowSizeChanger
        nzBordered
        nzSize="middle"
        nzAlign="middle"
      >
        <thead>
          <tr>
            <th
              style="
                text-align: center;
                vertical-align: middle;
                width: 5%;
                background-color: honeydew;
              "
            >
              SI.
            </th>
            <th
              style="
                text-align: center;
                vertical-align: middle;
                background-color: honeydew;
              "
            >
              File Name
            </th>
            <th
              style="
                text-align: center;
                vertical-align: middle;
                background-color: honeydew;
              "
            >
              Preview
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of basicTableOfAttachment.data; let i = index">
            <td style="text-align: center; vertical-align: middle">
              <nz-form-control
                style="text-align: center; vertical-align: middle"
              >
                {{ i + 1 }}
              </nz-form-control>
            </td>
            <td style="text-align: center; vertical-align: middle">
              {{ item?.fileName }}
            </td>
            <td style="text-align: center; vertical-align: middle">
              <button
                nz-button
                type="button"
                nzType="default"
                [nzSize]="'small'"
                (click)="setBase64AttachmentforPreviewing('document', i)"
              >
                <i nz-icon nzType="eye" nzTheme="fill"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </nz-card>
</nz-modal> -->
<nz-modal
  [(nzVisible)]="isVisible"
  (nzOnCancel)="handleCancel()"
  [nzClosable]="false"
  [nzOkText]="null"
  [nzWidth]="1200"
>
  <ng-container *nzModalContent>
    <iframe
      *ngIf="!isImageLoading && pdfUrl"
      [src]="pdfUrl"
      style="width: 100%; height: 35vw"
    ></iframe>
    <div style="text-align: center">
      <img class="img-thumbnail" *ngIf="imageURL" [src]="imageURL" /><br />
      <ng-template #noImageFound>
        <img
          src="https://gw.alipayobjects.com/zos/antfincdn/K%24NnlsB%26hz/pageHeader.svg"
          alt="Fallbackimage"
        />
      </ng-template>
    </div>
  </ng-container>
</nz-modal>

<nz-modal
  [(nzVisible)]="isVisibleOpinion"
  (nzOnCancel)="handleCancelOpinionModal()"
  [nzWidth]="1100"
>
  <div class="ng-Header col-xs-12">
    <i nz-icon nzType="unordered-list" nzTheme="outline"></i> List of Opinion
  </div>
  <div>
    <nz-table
      #opinion
      [nzData]="opinionInfo"
      nzTableLayout="fixed"
      nzShowSizeChanger
      nzBordered
      nzSize="middle"
      nzAlign="middle"
      [nzFrontPagination]="false"
      [nzTotal]="totalOpinion"
      [(nzPageSize)]="pageSizeOpinion"
      [nzShowTotal]="totalRowRangeTemplateOpinion"
      [(nzPageIndex)]="currentPageOpinion"
      (nzQueryParams)="onOpinionQueryParamsChange($event)"
    >
      <ng-template
        #totalRowRangeTemplateOpinion
        let-range="range"
        let-total
        style="text-align: left"
      >
        <div style="text-align: left">
          Showing {{ range[0] }}-{{ range[1] }} of {{ total }} items
        </div>
      </ng-template>
      <thead>
        <tr>
          <th style="width: 50px; text-align: center; vertical-align: middle">
            Sl
          </th>
          <th style="text-align: center; vertical-align: middle">Name</th>
          <th style="text-align: center; vertical-align: middle">
            Designation
          </th>
          <th style="text-align: center; vertical-align: middle">Contact</th>
          <th style="text-align: center; vertical-align: middle">Mail</th>
          <th style="text-align: center; vertical-align: middle">Opinion</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of opinion.data; let i = index">
          <td style="text-align: center; vertical-align: middle">
            {{ (currentPageOpinion - 1) * pageSizeOpinion + 1 + i }}
          </td>
          <td style="text-align: center; vertical-align: middle">
            {{ item.name }}
          </td>
          <td style="text-align: center; vertical-align: middle">
            {{ item.designation }}
          </td>
          <td style="text-align: center; vertical-align: middle">
            {{ item.contactNo }}
          </td>
          <td style="text-align: center; vertical-align: middle">
            {{ item.email }}
          </td>
          <td style="text-align: center; vertical-align: middle">
            {{ item.opinion }}
          </td>
        </tr>
      </tbody>
    </nz-table>
  </div>
  <div *nzModalFooter>
    <button nz-button nzType="primary" (click)="handleCancelOpinionModal()">
      Close
    </button>
  </div>
</nz-modal>
</nz-card>
```

### Component Class
```typescript
import { DatePipe } from '@angular/common';
import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup } from '@angular/forms';
import { NzNotificationService } from 'ng-zorro-antd/notification';
import { NzTableQueryParams } from 'ng-zorro-antd/table';
import { RplStorageService } from 'src/app/modules/stp-operations/services/rpl-storage.service';
import { ServerResponse } from 'src/app/shared/models/dto/server-response.dto';
import { applicationPermissions } from 'src/app/shared/application-constants/application-permissions';
import { ResearchStudiesMainSearch } from '../../models/research-studies-main-search-dto.model';
import { ResearchAndStudiesStorageService } from '../../services/research-and-studies-storage.service';
import { ResearchType } from '../../models/l_research-type.model';
import { ResearchStudiesMain } from '../../models/research-studies-main.model';
import { Author } from '../../models/author.model';
import { environment } from 'src/environments/environment';
import { RelatedResearch } from '../../models/related-research-DTO';
import { Attachment } from '../../models/attachment';
import { DomSanitizer, SafeUrl } from '@angular/platform-browser';
import JSZip from 'jszip';
import FileSaver from 'file-saver';
import { ExcelDownloadService } from 'src/app/shared/services/excel-download.service';
import { StpRegistrationStorageService } from 'src/app/modules/stp-registration/services/stp-registration-storage.service';
import { StpMain } from 'src/app/modules/course-accreditation/models/stp-main.model';
import { OpinionSearch } from '../../models/opinion-search';
import { HistoryLogSearch } from '../../models/history-log-search';
import { TranslateService } from '@ngx-translate/core';

@Component({
  selector: 'app-research-list-nsda',
  templateUrl: './research-list-nsda.component.html',
  styleUrls: ['./research-list-nsda.component.scss'],
})
export class ResearchListNsdaComponent implements OnInit {
  searchForm: FormGroup;

  researchStudiesMainSearch: ResearchStudiesMainSearch;
  researchTypeList: ResearchType[] = [];
  adminListInfo: ResearchStudiesMain[] = [];
  authorList: Author[] = [];
  accessTypeList: any[] = [];
  stpMainInfo: StpMain[] = [];
  previousFileBase64: any;
  opinionSearch: OpinionSearch;
  historyLogSearch : HistoryLogSearch;

  isVisibleOpinion: boolean = false;
  researchAndStudiesMainInfoDetails: any;
  opinionInfo: any[] = [];
  relatedResearchList: RelatedResearch[] = [];
  attachmentList: Attachment[] = [];
  // isVisibleDetails: boolean = false;
  stpMainId: number;
  stpCenterId: number;
  occupationId: number;
  applicationPermissions = applicationPermissions;

  //#region Excel part
  excelReportData: any;
  //#endregion

  // for pagination
  total: number = 0;
  size: number = 10;
  page: number = 1;
  sortingKey: string;
  sortingValue: string;

  currentPageOpinion: number = 1;
  pageSizeOpinion: number = 10;
  sortingKeyOpinion: string;
  sortingValueOpinion: string;
  totalOpinion: number = 0;

  //#region image part
  imageTypeArray: string[] = ['jpg', 'jpeg', 'png'];
  pdfUrl: any;
  imageUrl: any;
  imageURL: SafeUrl;
  signatureImageURL: SafeUrl;
  isImageLoading: boolean;
  isVisible: boolean = false;
  //#endregion

  constructor(
    private fb: FormBuilder,
    private rplStorageService: RplStorageService,
    private researchAndStudiesStorageService: ResearchAndStudiesStorageService,
    private notification: NzNotificationService,
    private sanitizer: DomSanitizer,
    private excelExport: ExcelDownloadService,
    private stpRegistrationStorageService: StpRegistrationStorageService,
    private datePipe: DatePipe,
    private translate: TranslateService
  ) {
    this.translate.use(environment.language.setDefaultLang);

    //#region
    this.stpRegistrationStorageService.readStpMains().subscribe({
      next: (res) => {
        this.stpMainInfo = [...res];
      },
    });
    //#endregion
  }

  //#region fetch research type data
  fetchResearchTypeData() {
    //Get researchType list
    this.researchAndStudiesStorageService.readResearchType().subscribe({
      next: (res) => {
        this.researchTypeList = [...res];
        this.researchTypeList.forEach((item, index) => {
          item.name = `${item.name} (${item.code})`;
        });
      },
    });
  }
  //#endregion
  //#region access type data
  fetchAccessTypeData() {
    this.researchAndStudiesStorageService.readAccessTypeData().subscribe({
      next: (res) => {
        this.accessTypeList = res;
      },
    });
  }
  //#endregion

  ngOnInit() {
    this.fetchResearchTypeData();
    this.fetchAccessTypeData();
    this.createSearchForm();
    this.submitSearchForm();
  }

  loadDatasFromServer(researchStudiesMainSearch: ResearchStudiesMainSearch) {
    this.researchAndStudiesStorageService
      .readAdminInfo(researchStudiesMainSearch)
      .subscribe({
        next: (res: ServerResponse) => {
          if (res.success) {
            this.adminListInfo = res?.data?.content;
            this.total = res.data?.totalElements;
          } else {
            this.adminListInfo = [];
            this.total = 0;
          }
        },
        error: (error) => {
          this.notification.warning('Warning!!! ', 'No data found');
          this.adminListInfo = [];
          this.total = 0;
        },
      });
  }

  createSearchForm() {
    this.searchForm = this.fb.group({
      documentId: [''],
      title: [''],
      accessTypeId: [null],
      researchTypeId: [null],
      researchFromDate: [null],
      researchToDate: [null],
      globalText: [null],
    });
  }

  //#region submit form
  submitSearchForm() {
    var pipe = new DatePipe('en-US');
    if (this.searchForm.controls.researchFromDate.value) {
      const generalFromDateFormat = pipe.transform(
        this.searchForm.controls.researchFromDate.value,
        'yyyy-MM-dd 00:00'
      );
      this.searchForm.controls.researchFromDate.setValue(generalFromDateFormat);
    }
    if (this.searchForm.controls.researchToDate.value) {
      const generalToDateFormat = pipe.transform(
        this.searchForm.controls.researchToDate.value,
        'yyyy-MM-dd 23:59'
      );
      this.searchForm.controls.researchToDate.setValue(generalToDateFormat);
    }
    this.researchStudiesMainSearch = this.searchForm.value;
    this.researchStudiesMainSearch.size = 10;
    this.researchStudiesMainSearch.page = 0;

    if (this.searchForm?.get('globalText')?.value) {
      this.getResearchStudiesDataByGlobalSearch(this.researchStudiesMainSearch);
    } else {
      this.loadDatasFromServer(this.researchStudiesMainSearch);
    }
  }
  //#endregion

  onRefresh() {
    this.searchForm?.reset();
    this.loadDatasFromServer(this.researchStudiesMainSearch);
  }

  getResearchStudiesDataByGlobalSearch(
    researchStudiesMainSearch: ResearchStudiesMainSearch
  ) {
    this.researchAndStudiesStorageService
      .getResearchStudiesDataByGlobalSearch(researchStudiesMainSearch)
      .subscribe({
        next: (res: ServerResponse) => {
          if (res.success) {
            this.adminListInfo = res?.data?.content;
            this.total = res.data?.totalElements;
          } else {
            this.adminListInfo = [];
            this.total = 0;
          }
        },
        error: (error) => {
          this.notification.warning('Warning!!! ', 'No data found');
          this.adminListInfo = [];
          this.total = 0;
        },
      });
  }

  onQueryParamsChange(params: NzTableQueryParams): void {
    this.page = params.pageIndex;
    this.size = params.pageSize;
    params.sort.forEach((element) => {
      if (element.value != null) {
        this.sortingKey = element.key;
        this.sortingValue = element.value;
      }
    });

    this.researchStudiesMainSearch.size = this.size;
    this.researchStudiesMainSearch.page = this.page - 1;
    this.researchStudiesMainSearch.sortingKey = this.sortingKey;
    this.researchStudiesMainSearch.sortingValue = this.sortingValue;
    this.loadDatasFromServer(this.researchStudiesMainSearch);
  }

  //#region roll back
  onRollBack(id: number, assessmentType: number) {
    this.rplStorageService.onRollBack(id, assessmentType).subscribe({
      next: (res) => {
        if (res.success) {
          this.notification.success('Success!', res.message);
          this.submitSearchForm();
          // this.router.navigateByUrl(
          //   '/home/'
          // );
        } else {
          this.notification.error('Failed!', res.message);
        }
      },
      error: (error) => {
        this.notification.error('Failed', error);
      },
    });
  }
  //#endregion

  deleteDocument(id: number, index: number) {
    this.researchAndStudiesStorageService.deleteDocument(id).subscribe(
      (res: ServerResponse) => {
        if (res.success) {
          this.notification.success('Success!', res.message);
          this.onRefresh();
        } else {
          this.notification.error('Error!', res.message);
        }
        // this.onRefresh();
      },
      (err) => {
        this.notification.error('Error!', 'Something went wrong!!');
      }
    );
  }

  onDownloadFile(id: number) {
    this.researchAndStudiesStorageService
      .getResearchStudiesMainDetailsInfoById(id)
      .subscribe({
        next: (res) => {
          this.researchAndStudiesMainInfoDetails = res;
          this.attachmentList =
            this.researchAndStudiesMainInfoDetails?.previewAttachments;

          if (this.attachmentList.length > 0) {
            this.setBase64AttachmentforFile(
              this.researchAndStudiesMainInfoDetails?.documentId
            );
          }
        },
      });
  }

  async setBase64AttachmentforFile(documentId: string) {
    const zip = new JSZip();
    const name = documentId + '.zip';

    for (let i = 0; i < this.attachmentList.length; i++) {
      const data = await fetch(
        environment.fileServiceApiUrl + this.attachmentList[i]?.fileUrl
      );

      if (data?.status == 200) {
        const blob = await data.blob();
        zip.file(this.attachmentList[i]?.fileName, blob);
      }
    }

    zip.generateAsync({ type: 'blob' }).then((content) => {
      if (content) {
        FileSaver.saveAs(content, name);
      }
    });
  }

  async setBase64AttachmentforPreviewing(fileName: string, i: number) {
    let fileUrl = '';
    switch (fileName) {
      case 'document':
        fileUrl =
          this.researchAndStudiesMainInfoDetails?.previewAttachments[i]
            ?.fileUrl ?? '';
        break;
    }
    const data = await fetch(environment.fileServiceApiUrl + fileUrl);
    const blob = await data.blob();
    let fileUrlBase64 = URL.createObjectURL(blob);
    let fileType = this.getFileTypeFromPreviousAttachment(fileUrl);
    this.previewAllImage(fileType, fileUrlBase64);
  }

  previewAllImage(fielType: string | undefined, fileUrl: any) {
    this.imageURL = '';
    this.pdfUrl = '';
    if (fielType == 'image') {
      this.isVisible = true;
      this.imageURL = this.sanitizer.bypassSecurityTrustResourceUrl(fileUrl);
    } else if (fielType == 'pdf') {
      this.isVisible = true;
      this.pdfUrl = this.sanitizer.bypassSecurityTrustResourceUrl(fileUrl);
    } else {
      const link = document.createElement('a');
      link.setAttribute('target', '_blank');
      link.setAttribute('href', this.previousFileBase64);
      link.setAttribute('download', 'uploaded_document');
      document.body.appendChild(link);
      link.click();
      link.remove();
    }
  }

  getFileTypeFromPreviousAttachment(fileUrl: string) {
    let contentType = '';
    let basename = fileUrl.split(/[\\/]/).pop();
    let pos = basename?.lastIndexOf('.') ?? 0;

    let fileType = basename?.slice(pos + 1) ?? '';
    if (this.imageTypeArray.includes(fileType)) {
      contentType = 'image';
    } else if (fileType == 'pdf') {
      contentType = 'pdf';
    } else if (fileType == 'doc') {
      contentType = 'doc';
    } else if (fileType == 'docx') {
      contentType = 'docx';
    } else if (fileType == 'xlsx') {
      contentType = 'xlsx';
    } else {
      contentType = 'other';
    }
    return contentType;
  }

  handleCancel(): void {
    this.isVisible = false;
  }
  //#endregion

  //#region opinion modal functionaily
  showModalForOpinion(id: number): void {
    this.opinionSearch = new OpinionSearch();
    this.opinionSearch.size = this.pageSizeOpinion;
    this.opinionSearch.page = this.currentPageOpinion - 1;
    this.opinionSearch.sortingKey = this.sortingKeyOpinion;
    this.opinionSearch.sortingValue = this.sortingValueOpinion;
    this.opinionSearch.researchStudiesMainId = id;
    this.viewOpinionInfoById(this.opinionSearch);
    this.isVisibleOpinion = true;
  }

  onOpinionQueryParamsChange(params: NzTableQueryParams): void {
    this.currentPageOpinion = params.pageIndex;
    this.pageSizeOpinion = params.pageSize;
    params.sort.forEach((element) => {
      if (element.value != null) {
        this.sortingKeyOpinion = element.key;
        this.sortingValueOpinion = element.value;
      }
    });

    this.opinionSearch.size = this.pageSizeOpinion;
    this.opinionSearch.page = this.currentPageOpinion - 1;
    this.opinionSearch.sortingKey = this.sortingKeyOpinion;
    this.opinionSearch.sortingValue = this.sortingValueOpinion;
    this.viewOpinionInfoById(this.opinionSearch);
  }

  viewOpinionInfoById(opinionSearch: OpinionSearch) {
    this.researchAndStudiesStorageService
      .getOpinionInfoById(opinionSearch)
      .subscribe({
        next: (res) => {
          this.opinionInfo = res.data?.content;
          this.totalOpinion = res.data.totalElements;
        },
      });
  }

  showHistoryLogView(id: number): void {
    this.historyLogSearch = new HistoryLogSearch();
    this.historyLogSearch.size = this.pageSizeOpinion;
    this.historyLogSearch.page = this.currentPageOpinion - 1;
    this.historyLogSearch.sortingKey = this.sortingKeyOpinion;
    this.historyLogSearch.sortingValue = this.sortingValueOpinion;
    this.historyLogSearch.researchStudiesMainId = id;
    this.viewHistoryInfoById(this.historyLogSearch);
  }
  viewHistoryInfoById(historyLogSearch: HistoryLogSearch) {
    this.researchAndStudiesStorageService
      .getHistoryLogViewInfoById(historyLogSearch)
      .subscribe({
        next: (res) => {
          this.opinionInfo = res.data?.content;

          console.log(this.opinionInfo);
          this.totalOpinion = res.data.totalElements;
        },
      });
  }

  handleCancelOpinionModal(): void {
    this.isVisibleOpinion = false;
  }
  //#endregion

  //#region download trainer info
  onDownloadReport() {
    this.researchAndStudiesStorageService
      .onDownloadRsReport(this.researchStudiesMainSearch)
      .subscribe(
        (res) => {
          this.excelReportData = res.data;
          let reportTitle = 'Research and Studies Information';
          if (
            this.excelReportData === null ||
            this.excelReportData?.length === 0
          ) {
            this.notification.warning(
              'Warning!',
              'No data available to download'
            );
          } else {
            const dataList = this.getFormatDataForExcel(this.excelReportData);
            this.excelExport.exportExcel(dataList, reportTitle);
          }
        },
        (error) => {
          this.notification.error('Error!', 'Excel Sheet Data fetch Failed');
        }
      );
  }

  getFormatDataForExcel(dataReport: any) {
    let i = 1;
    const dataList = [];
    for (const data of dataReport) {
      const reportMap = new Map();
      reportMap.set('#SL', i);
      reportMap.set('Document ID', data.documentId);
      this.stpMainId = data.stpMainId;
      let findStpMain = this.stpMainInfo.find(
        (stpMain) => stpMain.id == this.stpMainId
      );
      reportMap.set(
        'Research Start Date',
        this.datePipe.transform(data.researchFromDate, 'MM-dd-yyyy')
      );
      reportMap.set(
        'Research To Date',
        this.datePipe.transform(data.researchToDate, 'MM-dd-yyyy')
      );
      const jsonObject: any = {};
      reportMap.forEach((value, key) => {
        jsonObject[key] = value;
      });

      dataList.push(jsonObject);
      i++;
    }
    return dataList;
  }
}

```

## 2. Data Models

```typescript
export class MraInfoSearch {
  public agreementType: string;
  public organizationName: string;
  public countryName: string;
  // Other properties
}
```

## 3. Services

```typescript
import { HttpClient, HttpParams } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { AuthorizationService } from '../../authorization/services/authorization.service';
import { HttpErrorHandler } from 'src/app/shared/services/http-error-handler.service';
import { NzNotificationService } from 'ng-zorro-antd/notification';
import { ServerResponse } from 'src/app/shared/models/dto/server-response.dto';
import { applicationUrls } from 'src/app/shared/application-constants/application-urls.const';
import { map, tap } from 'rxjs/operators';
import { ResearchStudiesMainSearch } from '../models/research-studies-main-search-dto.model';
import { fileDeleteRequest } from '../models/fileDeleteRequest';
import { ResearchAndStudiesService } from './research-and-studies.service';
import { OpinionSearch } from '../models/opinion-search';
import { HistoryLogSearch } from '../models/history-log-search';

@Injectable({
  providedIn: 'root',
})
export class ResearchAndStudiesStorageService {
  constructor(
    private httpClient: HttpClient,
    private authorizationService: AuthorizationService,
    private httpErrorHandler: HttpErrorHandler,
    private notification: NzNotificationService,
    private researchAndStudiesService: ResearchAndStudiesService
  ) {}

  getIndustryList(): Observable<ServerResponse> {
    return this.httpClient.get<ServerResponse>(
      `${applicationUrls.tamIndustrialSector.read}`
    );
  }

  readResearchType(): Observable<any[]> {
    return this.httpClient
      .get<ServerResponse>(
        `${applicationUrls.researchAndStudies.researchTypeInfo}`
      )
      .pipe(
        map((serverResponse: ServerResponse) => {
          if (!serverResponse.data) {
            return [];
          }
          return serverResponse.data;
        })
      );
  }
  readLanguageData(): Observable<any[]> {
    return this.httpClient
      .get<ServerResponse>(`${applicationUrls.researchAndStudies.readLanguage}`)
      .pipe(
        map((serverResponse: ServerResponse) => {
          if (!serverResponse.data) {
            return [];
          }
          return serverResponse.data;
        })
      );
  }
  readAccessTypeData(): Observable<any[]> {
    return this.httpClient
      .get<ServerResponse>(
        `${applicationUrls.researchAndStudies.readAccessType}`
      )
      .pipe(
        map((serverResponse: ServerResponse) => {
          if (!serverResponse.data) {
            return [];
          }
          return serverResponse.data;
        })
      );
  }
  readRoleData(): Observable<any[]> {
    return this.httpClient
      .get<ServerResponse>(`${applicationUrls.researchAndStudies.readRole}`)
      .pipe(
        map((serverResponse: ServerResponse) => {
          if (!serverResponse.data) {
            return [];
          }
          return serverResponse.data;
        })
      );
  }
  readCommissionedByInfo(): Observable<any[]> {
    return this.httpClient
      .get<ServerResponse>(
        `${applicationUrls.researchAndStudies.commissionedByInfo}`
      )
      .pipe(
        map((serverResponse: ServerResponse) => {
          if (!serverResponse.data) {
            return [];
          }
          return serverResponse.data;
        })
      );
  }
  readFundInfo(): Observable<any[]> {
    return this.httpClient
      .get<ServerResponse>(`${applicationUrls.researchAndStudies.fundInfo}`)
      .pipe(
        map((serverResponse: ServerResponse) => {
          if (!serverResponse.data) {
            return [];
          }
          return serverResponse.data;
        })
      );
  }

  readConductOrOrganizationTypeInfo(): Observable<any[]> {
    return this.httpClient
      .get<ServerResponse>(
        `${applicationUrls.researchAndStudies.conductOrResearcherOrganizationTypeInfo}`
      )
      .pipe(
        map((serverResponse: ServerResponse) => {
          if (!serverResponse.data) {
            return [];
          }
          return serverResponse.data;
        })
      );
  }
  // readMinistaryAndAgency(): Observable<any[]> {
  //   return this.httpClient
  //     .get<ServerResponse>(
  //       `${applicationUrls.researchAndStudies.ministaryAndAgencyInfo}`
  //     )
  //     .pipe(
  //       map((serverResponse: ServerResponse) => {
  //         if (!serverResponse.data) {
  //           return [];
  //         }
  //         return serverResponse.data;
  //       })
  //     );
  // }

  readConductOrResearcherOrganization(): Observable<any[]> {
    return this.httpClient
      .get<ServerResponse>(
        `${applicationUrls.researchAndStudies.conductOrResearcherOrganizationInfo}`
      )
      .pipe(
        map((serverResponse: ServerResponse) => {
          if (!serverResponse.data) {
            return [];
          }
          return serverResponse.data;
        })
      );
  }

  checkResearchTypeNameIfExist(
    researchTypeName: string
  ): Observable<ServerResponse> {
    const params = new HttpParams().append(
      'researchTypeName',
      `${researchTypeName}`
    );
    return this.httpClient
      .get<ServerResponse>(
        `${applicationUrls.researchAndStudies.checkResearchTypeNameExist}`,
        { params }
      )
      .pipe(
        map((serverResponse: ServerResponse) => {
          return serverResponse;
        })
      );
  }
  checkResearchTypeCodeIfExist(
    researchTypeCode: string
  ): Observable<ServerResponse> {
    const params = new HttpParams().append(
      'researchTypeCode',
      `${researchTypeCode}`
    );
    return this.httpClient
      .get<ServerResponse>(
        `${applicationUrls.researchAndStudies.checkResearchTypeCodeExist}`,
        { params }
      )
      .pipe(
        map((serverResponse: ServerResponse) => {
          return serverResponse;
        })
      );
  }

  saveResearchType(researchType: any): Observable<any> {
    return this.httpClient.post<any>(
      `${applicationUrls.researchAndStudies.saveResearchType}`,
      researchType
    );
  }

  saveResearchAndStudiesMainInfo(
    researchSudiesInfo: any,
    fileList: File[]
  ): Observable<ServerResponse> {
    fileList.forEach((item: File, index: number) => {
      researchSudiesInfo.append('file', item);
    });
    return this.httpClient.post<ServerResponse>(
      `${applicationUrls.researchAndStudies.saveResearchAnsStudiesInfo}`,
      researchSudiesInfo
    );
  }

  updateResearchAndStudiesInfo(
    researchSudiesInfo: any,
    researchStudiesManiId: number | null,
    fileList: File[]
  ): Observable<ServerResponse> {
    fileList.forEach((item: File, index: number) => {
      researchSudiesInfo.append('file', item);
    });
    return this.httpClient.put<ServerResponse>(
      `${applicationUrls.researchAndStudies.updateResearchAnsStudiesInfo}` +
        researchStudiesManiId,
      researchSudiesInfo
    );
  }

  deleteAuthor(authorId?: number): Observable<ServerResponse> {
    return this.httpClient.delete<ServerResponse>(
      `${applicationUrls.researchAndStudies.deleteAuthor}` + authorId
    );
  }

  //#region read admin
  readAdminInfo(
    researchStudiesMainSearch: ResearchStudiesMainSearch
  ): Observable<ServerResponse> {
    researchStudiesMainSearch.disable = false;
    return this.httpClient.post<ServerResponse>(
      `${applicationUrls.researchAndStudies.getAdminList}`,
      researchStudiesMainSearch
    );
  }

  readRsMainInfoForRelatedResearch(
    researchStudiesMainSearch: ResearchStudiesMainSearch
  ): Observable<ServerResponse> {
    researchStudiesMainSearch.disable = false;
    return this.httpClient.post<ServerResponse>(
      `${applicationUrls.researchAndStudies.getRSMainListForRelatedResearch}`,
      researchStudiesMainSearch
    );
  }

  readExternalUserListInfo(
    researchStudiesMainSearch: ResearchStudiesMainSearch
  ): Observable<ServerResponse> {
    researchStudiesMainSearch.disable = false;
    return this.httpClient.post<ServerResponse>(
      `${applicationUrls.researchAndStudies.getExternalUsersList}`,
      researchStudiesMainSearch
    );
  }

  readIscUserListInfo(
    researchStudiesMainSearch: ResearchStudiesMainSearch
  ): Observable<ServerResponse> {
    researchStudiesMainSearch.disable = false;
    return this.httpClient.post<ServerResponse>(
      `${applicationUrls.researchAndStudies.getIscUsersList}`,
      researchStudiesMainSearch
    );
  }

  getResearchStudiesDataByGlobalSearch(
    researchStudiesMainSearch: ResearchStudiesMainSearch
  ): Observable<ServerResponse> {
    return this.httpClient.post<ServerResponse>(
      `${applicationUrls.researchAndStudies.getResearchStudiesDataByGlobalSearch}`,
      researchStudiesMainSearch
    );
  }

  //#region read admin
  readResearchAndStudiesPublicInfo(
    researchStudiesMainSearch: ResearchStudiesMainSearch
  ): Observable<ServerResponse> {
    researchStudiesMainSearch.disable = false;
    return this.httpClient.post<ServerResponse>(
      `${applicationUrls.researchAndStudies.getPublicList}`,
      researchStudiesMainSearch
    );
  }

  getResearchAndStudiesMainInfoDetailsById(
    id: number
  ): Observable<ServerResponse> {
    return this.httpClient.get<ServerResponse>(
      `${applicationUrls.researchAndStudies.getDetailsInfo}` + id
    );
  }

  getAuthorInfoById(id: number): Observable<ServerResponse> {
    return this.httpClient.get<ServerResponse>(
      `${applicationUrls.researchAndStudies.getAuthorInfo}` + id
    );
  }

  getResearchStudiesMainDetailsInfoById(
    researchStudiesMainId: number
  ): Observable<ServerResponse> {
    const params = new HttpParams().append(
      'researchStudiesMainId',
      `${researchStudiesMainId}`
    );
    return this.httpClient.get<ServerResponse>(
      `${applicationUrls.researchAndStudies.getResearchStudiesMainDetailsInfoById}`,
      { params }
    );
  }

  getResearchStudiesMainDetailsInfoByIdForPublicList(
    researchStudiesMainId: number
  ): Observable<ServerResponse> {
    const params = new HttpParams().append(
      'researchStudiesMainId',
      `${researchStudiesMainId}`
    );
    return this.httpClient.get<ServerResponse>(
      `${applicationUrls.researchAndStudies.getResearchStudiesMainDetailsInfoByIdForPublicList}`,
      { params }
    );
  }

  submitDocument(
    id?: any,
    isUserRoleExternalUsers?: boolean,
    isUserRoleIsc?: boolean,
    isUserTagNsda?: boolean
  ): Observable<ServerResponse> {
    return this.httpClient.put<ServerResponse>(
      `${applicationUrls.researchAndStudies.submitDocument}`,
      {
        researchStudiesMainId: id,
        isUserRoleExternalUsers: isUserRoleExternalUsers,
        isUserRoleIsc: isUserRoleIsc,
        isUserTagNsda: isUserTagNsda,
      }
    );
  }
  //#endregion

  onMakePublishPublicOrLimited(
    id?: any,
    statusTypeId?: any,
  ): Observable<ServerResponse> {
    return this.httpClient.put<ServerResponse>(
      `${applicationUrls.researchAndStudies.makePublishPublicOrPublishLimited}`,
      {
        researchStudiesMainId: id,
        statusTypeId: statusTypeId
      }
    );
  }
  //#endregion

  //#region delete document
  deleteDocument(researchStudiesMainId: number): Observable<ServerResponse> {
    return this.httpClient.put<ServerResponse>(
      `${applicationUrls.researchAndStudies.deleteDocument}`,
      {
        researchStudiesMainId: researchStudiesMainId,
      }
    );
  }
  deleteAttachment(data: fileDeleteRequest): Observable<ServerResponse> {
    return this.httpClient.post<ServerResponse>(
      `${applicationUrls.researchAndStudies.deleteAttachment}`,
      data
    );
  }

  saveIndustrySector(industrySector: any): Observable<any> {
    return this.httpClient.post<any>(
      `${applicationUrls.researchAndStudies.saveTamIndustrySector}`,
      industrySector
    );
  }

  saveRole(role: any): Observable<any> {
    return this.httpClient.post<any>(
      `${applicationUrls.researchAndStudies.saveRole}`,
      role
    );
  }

  saveConductedByForm(conductedBy: any): Observable<any> {
    return this.httpClient.post<any>(
      `${applicationUrls.researchAndStudies.saveConductedBy}`,
      conductedBy
    );
  }

  //#region remove document
  removeRelatedResearch(
    id: number,
    researchStudiesMainId: number
  ): Observable<ServerResponse> {
    return this.httpClient.put<ServerResponse>(
      `${applicationUrls.researchAndStudies.removeRelatedResearch}`,
      {
        id: id,
        researchStudiesMainId: researchStudiesMainId,
      }
    );
  }

  //#region download rs report
  onDownloadRsReport(
    sesearchStudiesMainSearch: ResearchStudiesMainSearch
  ): Observable<ServerResponse> {
    sesearchStudiesMainSearch.disable = true;
    return this.httpClient
      .post<ServerResponse>(
        applicationUrls.researchAndStudies.downloadRsReport,
        sesearchStudiesMainSearch
      )
      .pipe(
        tap((response) => {
          if (response.data) {
            this.researchAndStudiesService.setResearchAndStudiesInfoForReport(
              response.data
            );
          }
        })
      );
  }

  saveOpinion(opinionData: any): Observable<any> {
    return this.httpClient.post<any>(
      `${applicationUrls.researchAndStudies.saveOpinion}`,
      opinionData
    );
  }

  getOpinionInfoById(opinionSearch: OpinionSearch) {
    return this.httpClient.post<ServerResponse>(
      `${applicationUrls.researchAndStudies.getOpinionInfo}`,
      opinionSearch
    );
  }
  getHistoryLogViewInfoById(historyLogSearch: HistoryLogSearch) {
    return this.httpClient.post<ServerResponse>(
      `${applicationUrls.researchAndStudies.getHistoryLogInfo}`,
      historyLogSearch
    );
  }

  saveOrUpdateExternalUserRegFormManager(data: any): Observable<any> {
    console.log(data);

    return this.httpClient.post<any>(
      `${applicationUrls.researchAndStudies.externalUser.saveOrUpdateExternalUserRegFormInformation}`,
      data
    );
  }


  //#region read external user reg form manager count
readExternalUserRegFormInfo(): Observable<ServerResponse> {
  return this.httpClient
    .get<ServerResponse>(`${applicationUrls.researchAndStudies.externalUser.getExternalUserRegFormInformation}`)
}
//#endregion
}


```

## 4. Backend Implementation

### Controller
```java
    @PostMapping("/log")
    public ResponseEntity<?> getHistoryLogById(@RequestBody HistoryLogSearch historyLogSearch){
        ApiResponse history = iResearchStudiesMainService.getHistoryLogById(historyLogSearch);
        return new ResponseEntity(history, HttpStatus.OK);
    }

```

### Service Layer
```java
   public  ApiResponse getHistoryLogById(HistoryLogSearch historyLogSearch) {
       List<ResearchAndStudiesHistoryViewList> response = null ;
       try {
            response =  researchStudiesMainRepository.findResearchLogsByMainId(historyLogSearch.getResearchStudiesMainId());
       } catch (Exception e) {
           return new ApiResponse(false, "Could not get opinion info because " + e.getMessage());
       }
       return new ApiResponse(true, "Data fetched successfully",response);
   }
}
```

### Repository
```java
@Repository
public interface MraRepository extends JpaRepository<MRA,Long> {

    @Query(value = "SELECT rlhv.table_name as tableName, " +
            "rlhv.document_id as documentId, " +
            "rlhv.title as title, " +
            "rlhv.research_from_date as researchFromDate, " +
            "rlhv.research_to_date as researchToDate, " +
            "rlhv.action as actionType, " +
            "rlhv.old_value as oldValue, " +
            "rlhv.new_value as newValue, " +
            "rlhv.access_type_name as accessTypeName, " +
            "rlhv.resarch_type_name as researchTypeName, " +
            "rlhv.resarch_stadies_user_type_name as researchStadiesUserTypeName, " +
            "rlhv.status_type_name as statusTypeName, " +
            "rlhv.action_date as actionDate " +
            "FROM public.resarch_log_history_view  rlhv "+
            "WHERE rlhv.research_studies_main_id  = CAST(:id AS BIGINT)"+
            "OR (rlhv.id = CAST(:id AS BIGINT) AND rlhv.table_name = 'research_studies_main_log')",
            nativeQuery = true)
    List<ResearchAndStudiesHistoryViewList> findResearchLogsByMainId(
            @Param("id") Long id
    );
}
```